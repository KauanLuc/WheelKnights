<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/feed.css">
    <title>Registro de Miniaturas - WK</title>
</head>
<body>

    <nav class="main_menu">

        <div class="menu_links">

            <h1 class="brand_font">WheelKnights</h1>
            <!--<img src="../assets/img/WheelKnights.png" alt="logo WheelKnights" class="brand_logo">-->  
            <input type="text" name="ms" class="search_top" placeholder="Pesquisar">

            <div class="menu_icons">

                <img src="assets/img/icon-feed-white.png" alt="feed" class="icon" onclick="goFeed()">
                <img src="assets/img/icon-register.png" alt="registrar miniaturas" class="icon">
                <img src="assets/img/icon-dashboard-white.png" alt="dashboard" class="icon" onclick="goDashboard()">
                <img src="assets/img/icon-album-white.png" alt="album" class="icon" onclick="goAlbum()">
                <img src="assets/img/wheelknightslogo.png" alt="foto de perfil" class="icon profile_user">

            </div>

        </div>

    </nav>

    <section>

        <div class="register_content">
            
            <h1>Registro de Miniaturas</h1><br>

                <input type="text" placeholder="Modelo" class="inputForm" id="modelo">

                <select id="marca">

                    <option disabled selected hidden value="1">Selecione uma marca</option>
                    <option value="2">Hot Wheels</option>
                    <option value="3">Matchbox</option>
                    <option value="4">Kyosho</option>
                    <option value="5">Tomy</option>
                    <option value="6">Siku</option>
                    <option value="7">Jada</option>
                    <option value="8">Johnny Lightning</option>
                    <option value="1">Outro</option>

                </select>
  
                <select id="tematica">

                    <option disabled selected hidden value="1">Selecione o tema da sua miniatura</option>
                    <option value="2">Os Simpsons</option>
                    <option value="3">Batman</option>
                    <option value="4">Os Flintstones</option>
                    <option value="5">Scooby-Doo!</option>
                    <option value="1">Nenhum</option>

                </select>

                <select id="tipoVeiculo">

                    <option disabled selected hidden value="1">Selecione o tipo de veículo</option>
                    <option value="2">Carro</option>
                    <option value="3">Moto</option>
                    <option value="4">Caminhão</option>
                    <option value="5">Militar</option>
                    <option value="6">Barco</option>
                    <option value="7">Avião</option>
                    <option value="1">Outro</option>

                </select>

                <input type="number" placeholder="Preço de Compra" class="inputForm" id="valorCompra">

                <label for="foto">Clique e escolha uma imagem de sua miniatura</label>
                <input type="file" name="foto" id="foto">

                <button onclick="cadastrar()">Registrar</button>

        </div>
        
    </section>
</body>
</html>

<script>

const urlParams = new URLSearchParams(window.location.search);
const idUsuario = urlParams.get('idUsuario');

function goFeed(){

    window.location.href = `feed.html?idUsuario=${idUsuario}`;
}

function goDashboard(){

    window.location.href = `dashboard/dashboard.html?idUsuario=${idUsuario}`;
}

function goAlbum() {

    window.location.href = `dashboard/miniAlbum.html?idUsuario=${idUsuario}`;
}

function cadastrar() {
    var fkColecaoVar = idUsuario;
    var fkMarcaVar = Number(marca.value);
    var modeloVar = modelo.value;
    var fkTematicaVar = Number(tematica.value);
    var fkTipoVeiculoVar = Number(tipoVeiculo.value);
    var valorCompraVar = Number(valorCompra.value);

    // Crie um objeto FormData
    var formData = new FormData();
    formData.append('fkColecao', fkColecaoVar);
    formData.append('fkMarca', fkMarcaVar);
    formData.append('modelo', modeloVar);
    formData.append('fkTematica', fkTematicaVar);
    formData.append('fkTipoVeiculo', fkTipoVeiculoVar);
    formData.append('valorCompra', valorCompraVar);
    formData.append('foto', foto.files[0]);

    if (
        fkMarcaVar === null ||
        modeloVar === "" ||
        fkTipoVeiculoVar === null
    ) {
        alert("Marca, modelo e Tipo do veículo são obrigatórios");
        return false;
    }

    fetch("registerMiniature/cadastrar", {
        method: "POST",
        body: formData, 
    })
    .then(function(resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
            alert("Miniatura cadastrada com sucesso!");
        } else {
            throw "Houve um erro ao tentar realizar o cadastro da miniatura.";
        }
    })
    .catch(function(resposta) {
        console.log(`#ERRO: ${resposta}`);
    });

    return false;
}


</script>